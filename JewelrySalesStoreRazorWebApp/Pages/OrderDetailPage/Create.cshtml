@page
@model JewelrySalesStoreRazorWebApp.Pages.OrderDetailPage.CreateModel

@{
    ViewData["Title"] = "Create";
}

<h1>Create</h1>

<h4>OrderDetail</h4>
<hr />
<div class="row">
    <div class="col-md-4">
        <form method="post">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <div class="form-group">
                <label asp-for="OrderDetail.OrderId" class="control-label"></label>
                <input asp-for="OrderDetail.OrderId" class="form-control" />
                <span asp-validation-for="OrderDetail.OrderId" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="OrderDetail.ProductId" class="control-label"></label>
                <select asp-for="OrderDetail.ProductId" class="form-control" asp-items="@Model.ProductsSelectList"></select>
                <span asp-validation-for="OrderDetail.ProductId" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="OrderDetail.Quantity" class="control-label"></label>
                <input asp-for="OrderDetail.Quantity" class="form-control" id="quantityInput" />
                <span asp-validation-for="OrderDetail.Quantity" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="OrderDetail.UnitPrice" class="control-label"></label>
                <input asp-for="OrderDetail.UnitPrice" class="form-control" id="unitPriceInput" readonly />
                <span asp-validation-for="OrderDetail.UnitPrice" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="OrderDetail.TotalPrice" class="control-label"></label>
                <input asp-for="OrderDetail.TotalPrice" class="form-control" id="totalPriceInput" readonly />
                <span asp-validation-for="OrderDetail.TotalPrice" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="OrderDetail.DiscountPrice" class="control-label"></label>
                <input asp-for="OrderDetail.DiscountPrice" class="form-control" id="discountPriceInput" />
                <span asp-validation-for="OrderDetail.DiscountPrice" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="OrderDetail.FinalPrice" class="control-label"></label>
                <input asp-for="OrderDetail.FinalPrice" class="form-control" id="finalPriceInput" readonly />
                <span asp-validation-for="OrderDetail.FinalPrice" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="OrderDetail.IsActive" class="control-label"></label>
                <select asp-for="OrderDetail.IsActive" class="form-control">
                    <option value="true">True</option>
                    <option value="false">False</option>
                </select>
            </div>
            <div class="form-group">
                <label asp-for="OrderDetail.Notes" class="control-label"></label>
                <input asp-for="OrderDetail.Notes" class="form-control" />
                <span asp-validation-for="OrderDetail.Notes" class="text-danger"></span>
            </div>

            <div class="form-group mt-2">
                <input type="submit" value="Create" class="btn btn-success" />
                <a style="text-decoration: none;" class="btn btn-secondary text-white" asp-page="Index">Back</a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        document.getElementById('quantityInput').addEventListener('input', function () {
            var quantity = parseFloat(this.value);
            var unitPrice = parseFloat(document.getElementById('unitPriceInput').value);
            if (!isNaN(quantity) && !isNaN(unitPrice)) {
                var totalPrice = quantity * unitPrice;
                document.getElementById('totalPriceInput').value = totalPrice.toFixed(2);
                var discountPrice = parseFloat(document.getElementById('discountPriceInput').value) || 0;
                var finalPrice = totalPrice - discountPrice;
                document.getElementById('finalPriceInput').value = finalPrice.toFixed(2);
            }
        });

        document.getElementById('discountPriceInput').addEventListener('input', function () {
            var discountPrice = parseFloat(this.value) || 0;
            var totalPrice = parseFloat(document.getElementById('totalPriceInput').value);
            if (!isNaN(totalPrice)) {
                var finalPrice = totalPrice - discountPrice;
                document.getElementById('finalPriceInput').value = finalPrice.toFixed(2);
            }
        });

        document.getElementById('OrderDetail_ProductId').addEventListener('change', function () {
            var productId = this.value;
            if (productId) {
                fetch(`/api/products/${productId}`)
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById('unitPriceInput').value = data.price.toFixed(2);
                    });
            }
        });
    </script>
}
